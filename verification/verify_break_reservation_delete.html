<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Verification: Break Reservation Deletion</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="bg-gray-100 p-8">
    <h1 class="text-xl font-bold mb-4">Verification for Break Reservation Deletion</h1>
    <p class="mb-4">This page tests if the delete confirmation dialog appears only once after re-rendering the list.</p>

    <button id="rerender-btn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded mb-4 hover:bg-blue-600">
        Simulate Re-render
    </button>

    <div class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg">
        <h2 class="text-lg text-gray-700 font-medium">予約設定</h2>
        <div id="break-reservation-list" class="mt-4 space-y-2">
            <!-- Reservation items will be injected here -->
        </div>
    </div>

    <!-- Confirmation Modal (Simplified) -->
    <div id="confirmation-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Confirmation</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500" id="confirmation-message"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="confirm-ok" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-300">OK</button>
                    <button id="confirm-cancel" class="px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-200">Cancel</button>
                </div>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeClientView } from '/js/views/client/client.js';
        import { updateReservationDisplay, deleteReservation, userReservations } from '/js/views/client/reservations.js';

        // --- Mock Data and Functions ---
        const mockReservations = [
            { id: '1', action: 'break', time: '12:00' },
            { id: '2', action: 'break', time: '15:00' }
        ];

        // Replace the real list with our mock data
        Object.assign(userReservations, mockReservations);

        // Mock the confirm function to show our custom modal and track calls
        let confirmCallCount = 0;
        window.confirm = (message) => {
            confirmCallCount++;
            console.log(`confirm() called ${confirmCallCount} times with message: "${message}"`);

            const modal = document.getElementById('confirmation-modal');
            const messageEl = document.getElementById('confirmation-message');
            const okBtn = document.getElementById('confirm-ok');

            messageEl.textContent = message;
            modal.classList.remove('hidden');

            // Simulate user clicking "OK"
            okBtn.onclick = () => {
                modal.classList.add('hidden');
            };

            // For the test, we always simulate "OK" was pressed.
            return true;
        };

        // --- Initial Setup ---

        // This simulates the main app initialization.
        // We pass empty tasks as they are not needed for this specific test.
        await initializeClientView({ tasks: [] });

        // Initial render of the reservation list
        updateReservationDisplay();

        // --- Test Logic ---
        const rerenderBtn = document.getElementById('rerender-btn');
        rerenderBtn.addEventListener('click', async () => {
            console.log("Simulating leaving and re-entering the view...");
            // Simulate re-initialization which caused the original bug
            await initializeClientView({ tasks: [] });
            // Re-render the list with the same data
            updateReservationDisplay();
            console.log("Re-render complete.");
        });

        // Add a global helper for Playwright to get the call count
        window.getConfirmCallCount = () => confirmCallCount;

    </script>
</body>
</html>
